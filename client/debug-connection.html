<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Connection Debug Tool</h1>
    
    <div id="config-info" class="status info">
        <h3>Configuration Info</h3>
        <div id="config-details"></div>
    </div>
    
    <div id="connection-test" class="status info">
        <h3>Connection Test</h3>
        <button onclick="testLocalConnection()">Test Local Server (3001)</button>
        <button onclick="testProductionConnection()">Test Production Server</button>
        <button onclick="testSocketConnection()">Test Socket.IO Connection</button>
        <div id="test-results"></div>
    </div>
    
    <div id="socket-test" class="status info">
        <h3>Socket.IO Test</h3>
        <button onclick="startSocketTest()">Start Socket Test</button>
        <button onclick="stopSocketTest()">Stop Socket Test</button>
        <div id="socket-status"></div>
    </div>

    <script type="module">
        // Import the config
        import { getServerUrl, testBackendAvailability } from './src/lib/config.ts';
        
        let socket = null;
        
        // Display configuration info
        function displayConfig() {
            const configDiv = document.getElementById('config-details');
            const serverUrl = getServerUrl();
            
            configDiv.innerHTML = `
                <pre>
Environment Variables:
- VITE_SERVER_URL: ${import.meta.env.VITE_SERVER_URL || 'not set'}
- DEV: ${import.meta.env.DEV}
- PROD: ${import.meta.env.PROD}
- NODE_ENV: ${import.meta.env.NODE_ENV}

Browser Info:
- Hostname: ${window.location.hostname}
- Port: ${window.location.port}
- Full URL: ${window.location.href}
- Is Localhost: ${window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'}

Selected Server URL: ${serverUrl}
                </pre>
            `;
        }
        
        // Test local server connection
        window.testLocalConnection = async function() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing local server...</p>';
            
            try {
                const isAvailable = await testBackendAvailability('http://localhost:3001');
                if (isAvailable) {
                    resultsDiv.innerHTML += '<div class="status success">‚úÖ Local server (localhost:3001) is reachable</div>';
                } else {
                    resultsDiv.innerHTML += '<div class="status error">‚ùå Local server (localhost:3001) is not reachable</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="status error">‚ùå Error testing local server: ${error.message}</div>`;
            }
        };
        
        // Test production server connection
        window.testProductionConnection = async function() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing production server...</p>';
            
            try {
                const isAvailable = await testBackendAvailability('https://metaverse-project-2.onrender.com');
                if (isAvailable) {
                    resultsDiv.innerHTML += '<div class="status success">‚úÖ Production server is reachable</div>';
                } else {
                    resultsDiv.innerHTML += '<div class="status error">‚ùå Production server is not reachable</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="status error">‚ùå Error testing production server: ${error.message}</div>`;
            }
        };
        
        // Test Socket.IO connection
        window.testSocketConnection = async function() {
            const resultsDiv = document.getElementById('test-results');
            const serverUrl = getServerUrl();
            resultsDiv.innerHTML = `<p>Testing Socket.IO connection to: ${serverUrl}</p>`;
            
            try {
                // Import socket.io-client dynamically
                const { io } = await import('socket.io-client');
                
                const testSocket = io(serverUrl, {
                    transports: ['polling', 'websocket'],
                    timeout: 10000,
                    forceNew: true
                });
                
                testSocket.on('connect', () => {
                    resultsDiv.innerHTML += `<div class="status success">‚úÖ Socket.IO connected! ID: ${testSocket.id}</div>`;
                    testSocket.disconnect();
                });
                
                testSocket.on('connect_error', (error) => {
                    resultsDiv.innerHTML += `<div class="status error">‚ùå Socket.IO connection failed: ${error.message}</div>`;
                });
                
                setTimeout(() => {
                    if (!testSocket.connected) {
                        resultsDiv.innerHTML += '<div class="status error">‚ùå Socket.IO connection timeout</div>';
                        testSocket.disconnect();
                    }
                }, 10000);
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="status error">‚ùå Error setting up Socket.IO test: ${error.message}</div>`;
            }
        };
        
        // Socket test functions
        window.startSocketTest = function() {
            const statusDiv = document.getElementById('socket-status');
            const serverUrl = getServerUrl();
            
            statusDiv.innerHTML = `<p>Starting Socket.IO test to: ${serverUrl}</p>`;
            
            import('socket.io-client').then(({ io }) => {
                socket = io(serverUrl, {
                    transports: ['polling', 'websocket'],
                    timeout: 15000,
                    forceNew: true
                });
                
                socket.on('connect', () => {
                    statusDiv.innerHTML += `<div class="status success">‚úÖ Connected! Socket ID: ${socket.id}</div>`;
                });
                
                socket.on('disconnect', (reason) => {
                    statusDiv.innerHTML += `<div class="status error">‚ùå Disconnected: ${reason}</div>`;
                });
                
                socket.on('connect_error', (error) => {
                    statusDiv.innerHTML += `<div class="status error">‚ùå Connection error: ${error.message}</div>`;
                });
                
                socket.on('connecting', () => {
                    statusDiv.innerHTML += '<div class="status info">üîÑ Connecting...</div>';
                });
            });
        };
        
        window.stopSocketTest = function() {
            if (socket) {
                socket.disconnect();
                socket = null;
                document.getElementById('socket-status').innerHTML += '<div class="status info">üõë Socket test stopped</div>';
            }
        };
        
        // Initialize
        displayConfig();
    </script>
</body>
</html> 